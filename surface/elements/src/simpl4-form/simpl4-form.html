<polymer-element name="simpl4-form">
	<template>
		<link rel="stylesheet" type="text/css" href="grids.css" />
		<link rel="stylesheet" type="text/css" href="grids-responsive.css" />
		<style>
			body,
			button,
			pre,
			input {
				font-family: sans-serif;
			}
			[column] {
				min-width: 320px;
				max-width: 700px;
				margin: 0 auto;
			}
			#form {
				background-color: whitesmoke;
			}
			[segment] > segment {
				margin-left: 0;
			}
			segment {
				margin-top: 8px !important;
				margin-bottom: 8px !important;
			}
			ssn-field {
				min-width: 220px;
			}
			paper-item {
				overflow: hidden;
				white-space: nowrap;
				text-overflow: ellipsis;
				font-size: 12px;
			}
		</style>
		<paper-form segment id="form">

			<h2>Form-factor</h2>

			<segment>
				<paper-row if="row" class="pure-g">
					<div class="pure-control-group">
						<input-field type="text" id="OrderName" name="OrderName" value="{{item.orderId}}" editValue="{{orderId}}" xnvalidated="{{item.orderId | validateOrderId}}" error="Must be at least five characters long"></input-field>
					</div>
				</paper-row>
				<paper-row>
					<div class="pure-control-group pure-u-1 pure-u-md-11-24">
						<ssn-field name="SSN1" value="{{item.ssn}}"></ssn-field>
					</div>
					<div class="pure-control-group pure-u-1 pure-u-md-11-24">
						<ssn-field name="SSN" value="{{item.ssn}}"></ssn-field>
					</div>
				</paper-row>
				<paper-row>
					<div class="pure-control-group pure-u-1 pure-u-md-11-24">
						<ssn-field name="SSNAAAAAAA" value="{{item.ssn}}"></ssn-field>
					</div>
					<div class="pure-control-group pure-u-1 pure-u-md-11-24">
						<ssn-field name="SSN" value="{{item.ssn}}"></ssn-field>
					</div>
				</paper-row>
			</segment>

			<segment>
				<paper-row>
					<div class="pure-control-group">
						<input-field type="date" id="FlanFlavor" name="FlanFlavor" value="{{item.flavor}}" editValue="{{flavor}}" xnvalidated="{{item.flavor | validateFlavor}}" error="Any flavor is fine, as long as it contains chocolate"></input-field>
					</div>
					<slider-field name="Viscosity" value="{{item.viscosity}}"></slider-field>
				</paper-row>

				<paper-row>
					<toggle-field name="Whip Cream" value="{{item.whipCream}}"></toggle-field>
					<checkbox-field name="Egg Cream" value="{{item.eggCream}}"></checkbox-field>
					<toggle-field name="Heavy Cream" value="{{item.heavyCream}}"></toggle-field>
					<checkbox-field name="Sweet Cream" value="{{item.sweetCream}}"></checkbox-field>
				</paper-row>
			</segment>

			<segment>
				<paper-row>
					<radio-field name="Shape" value="{{item.shape}}">
						<paper-radio-button label="Square" active></paper-radio-button>
						<paper-radio-button label="Circle"></paper-radio-button>
						<paper-radio-button label="Tubular"></paper-radio-button>
						<paper-radio-button label="Mobius"></paper-radio-button>
					</radio-field>
				</paper-row>

				<dropdown-field one-column name="Extra Layers ({{item.layers || 0}})" value="{{item.layers}}">
					<paper-item>Single Layer</paper-item>
					<paper-item>One Extra Layer</paper-item>
					<paper-item>Two Extra Layers</paper-item>
					<paper-item>Three Extra Layers</paper-item>
				</dropdown-field>
			</segment>

			<div>
				<button on-tap="{{submit}}">Submit</button>
			</div>

		</paper-form>

		<segment>
			Your form data:
			<pre><code id="data"></code></pre>
		</segment>
	</template>
	<script>
		Polymer("simpl4-form", {
			item: {
				shape: 0
			},

			submit: function(e) {
				var v = regula.validate({
					element: this.$.OrderName
				});
				console.log("V:", v);
				return;
				//var is = this.v.validate();
				var is = this.v.isValid();
				console.log("isValid:", is);
				var info = '';
				//if (!this.$.form.validate()) {
				//	info += '* form is not valid\n\n';
				//}
				var data = this.$.form.dump();
				info += JSON.stringify(data, null, 2);
				console.log("Info:" + info);


				this.$.data.textContent = info;
			},

			validateOrderId: function(value) {
				return;
				console.log("validateOrderId:" + value);
				if (this.$) {
					var v = regula.validate({});
					console.log("V:", v);
				}
				return !value || value.length < 5;
			},

			validateFlavor: function(value) {
				return !value || value.toLowerCase().indexOf('chocolate') < 0;
			},
			attached: function() {
				this.fire('add-form-field');
			},
			detached: function() {
				this.fire('remove-form-field');
			},
			valueChanged: function(e) {
				return;
				for(var i=0; i < this.allFields.length;i++){
					this.allFields[i].invalidated=false;
				}
				console.log(e.type, e.detail);
				var cvList = regula.validate();
				console.log("cvList:", cvList);
				for(var i=0; i < cvList.length;i++){
					var cv = cvList[i];
					cv.failingElements[0].invalidated=true;
				}
			},
			domReady: function() {
				console.log("RegulaBind");
				regula.bind({
					element: this.$.OrderName,
					constraints: [{
						constraintType: regula.Constraint.Min,
						params: {
							value: "18",
							message: "You must be at least 18 years old to vote",
							groups: ['MyGroup']
						}
					}]
				});
				regula.bind({
					element: this.$.FlanFlavor,
					constraints: [{
						constraintType: regula.Constraint.Future,
						params: {
							format: regula.DateFormat.YMD,
							date: "2015/2/1",
							groups: ['MyGroup']
						}
					}]
				});
 console.log("isBound:"+this.$.FlanFlavor.id, regula.isBound({element: this.$.FlanFlavor}));
				return;
				this.allFields = 	this.$.form.querySelectorAll('input-field');
				this.allFieldsMap={};
				for(var i=0; i < this.allFields.length;i++){
						console.log("addEventListener:",this.allFields[i]);
						this.allFields[i].addEventListener("value-changed", this.valueChanged.bind(this));
						this.allFieldsMap[this.allFields[i].id] = this.allFields[i];
				}
			}
		});
	</script>
</polymer-element>
