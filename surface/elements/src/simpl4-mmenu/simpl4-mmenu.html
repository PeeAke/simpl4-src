<link rel="import" href="mmenu-import.html">

<polymer-element name="simpl4-mmenu" attributes="searchfield slidingSubmenus pages selected selectedModel" flex relative>
<template>
  <link rel="stylesheet" type="text/css" href="simpl4-mmenu.css" />
  <nav id="mainmenu">
    <ul>
      <template repeat="{{node in nodes }}" id="t">
        <template if="{{ node.children==null || node.children.length==0 }}">
          <li>
            <a onclick="return false" href="#"><font-awesome icon="{{node.icon}}"></font-awesome>{{node.name}}</a>
          </li>
        </template>
        <template if="{{ node.children && node.children.length>0 }}">
          <li>
            <a onclick="return false" href="#"><font-awesome icon="{{node.icon}}"></font-awesome>{{node.name}}</a>
            <ul>
              <template ref="t" repeat="{{node in node.children}}"></template>
            </ul>
          </li>
        </template>
      </template>
    </ul>
  </nav>
  <content></content>
</template>
  <script>
			Polymer('simpl4-mmenu', {
				ready: function () {
					console.log("Ready:"+this.slidingSubmenusd);
					$(this.$.mainmenu).mmenu({
						classes: "mm-light mm-zoom-panels",
						slidingSubmenus: this.slidingSubmenus == "true",
						searchfield: this.searchfield != "false",
						body: $(this.$.mainmenu),
						offCanvas: false

					});
					console.log("Ready2");
					Polymer.addEventListener(this.$.mainmenu, "tap", this.activateListener.bind(this));
				},
				activateListener:function(e){
					console.debug("activateListener:",e.srcElement);
					if( e.srcElement["className"]=="mm-subopen"){
						return;
					}
					var m = e.target.templateInstance.model;
					var n = e.target.templateInstance.model.node;
					//console.log("E:"+JSON.stringify(n,null,2));
					console.dir(e.target.templateInstance.model);
					if( this.selectedModel){
						this.fire("mmenu-selected", {isSelected:false,model:this.selectedModel } );
					}
					this.selectedModel = e.target.templateInstance.model;
					this.fire("mmenu-selected", {isSelected:true,model:this.selectedModel } );
console.debug("Selected:"+this.selected);
					this.selected = n.hash;
console.debug("Hash:"+n.hash);
				},

				created: function () {
					console.log("created");
					this.nodes = [{
						"name": "Croatia",
						"icon": "fax",
						"hash": "0"
					},
					{
						"name": "England",
						"hash": "1",
						"icon": "home",
						"children": [{
							"name": "Arsenal",
							"url": "test.adoc",
							"icon": "gift",
							"hash": "0-0"
						},
						{
							"name": "Manchester United",
							"url": "test.adoc",
							"icon": "key",
							"hash": "0-2"
						}]
					},
					{
						"name": "Spain",
						"hash": "2",
						"icon": "inbox",
						"children": [{
							"name": "Barcelona",
							"icon": "plug",
							"hash": "2-0"
						},
						{
							"name": "Real Madrid",
							"icon": "mobile",
							"hash": "2-1"
						}]
					},
					{
						"name": "Germany",
						"hash": "3",
						"icon": "globe",
						"children": [{
							"name": "Bayern Munich",
							"icon": "plus",
							"hash": "3-1"
						},
						{
							"name": "Borrusia Dortmund",
							"icon": "minus",
							"hash": "3-2"
						}]
					}];
					this.pages = [];
					this._traverse(this.nodes);
				},
				_traverse: function (nodes) {
					for (var i = 0; i < nodes.length; i++) {
						var node = nodes[i];
						if (node.children && node.children.length > 0) {
							this.pages.push(node);
							this._traverse(node.children);
						} else {
							var page = {
								name: node.name,
								url: node.url,
								hash: node.hash
							}
							this.pages.push(node);
						}
					}
				}
			});
  </script>
</polymer-element>
