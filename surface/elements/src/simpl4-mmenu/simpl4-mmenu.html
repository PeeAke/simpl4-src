<link rel="import" href="mmenu-import.html">

<polymer-element name="simpl4-mmenu" attributes="searchfield slidingSubmenus pages" flex relative>
	<template>
		<link rel="stylesheet" type="text/css" href="simpl4-mmenu.css" />
		<nav class="nav" id="mainmenu">
			<ul>
				<template repeat="{{node in nodes  }}" id="t">
					<template if="{{ node.children==null || node.children.length==0 }}">
						<li class="{{ level==-1 ? 'firstLevel' : ''}}" id="X{{node.hash}}">
							<a onclick="return false" href="{{node.url}}">
								<font-awesome icon="{{node.icon}}"></font-awesome>{{node.name}}</a>
						</li>
					</template>
					<template if="{{ node.children && node.children.length>0 }}">
						<li class="{{ level==-1 ? 'firstLevel' : ''}}" id="X{{node.hash}}">
							<a onclick="return false" href="#">
								<font-awesome icon="{{node.icon}}"></font-awesome>{{node.name}}</a>
							<ul>
								<template ref="t" repeat="{{node,level in node.children}}"></template>
							</ul>
						</li>
					</template>
				</template>
			</ul>
		</nav>
		<content></content>
	</template>
	<script>
		Polymer('simpl4-mmenu', {
			level: -1,
			ready: function() {
				console.log("MMenu.Ready");
				$(this.$.mainmenu).mmenu({
					classes: "mm-white mm-zoom-panels",
					slidingSubmenus: this.slidingSubmenus == "true",
					searchfield: this.searchfield != "false",
					body: $(this.$.mainmenu),
					offCanvas: false

				});
			},
			created: function() {
				console.log("created");
				this.nodes = [{
					"name": "Croatia",
					"icon": "fax",
					"url": "test3.adoc",
					"hash": "0"
				}, {
					"name": "England",
					"hash": "1",
					"icon": "home",
					"children": [{
						"name": "Arsenal",
						"url": "test.adoc",
						"icon": "gift",
						"hash": "0-0"
					}, {
						"name": "Manchester United",
						"url": "test2.adoc",
						"icon": "key",
						"hash": "0-2"
					}]
				}, {
					"name": "Spain",
					"hash": "2",
					"url": "test.html",
					"icon": "inbox",
					"children": [{
						"name": "Barcelona",
						"icon": "plug",
						"hash": "2-0"
					}, {
						"name": "Real Madrid",
						"icon": "mobile",
						"hash": "2-1"
					}]
				}, {
					"name": "Germany",
					"hash": "3",
					"icon": "globe",
					"children": [{
						"name": "Bayern Munich",
						"icon": "plus",
						"hash": "3-1"
					}, {
						"name": "Borrusia Dortmund",
						"icon": "minus",
						"hash": "3-2"
					}]
				}];
				this.pages = [];
				this._traverse(this.nodes);
			},
			_traverse: function(nodes) {
				for (var i = 0; i < nodes.length; i++) {
					var node = nodes[i];
					//					node.hash = node.url;
					if (node.children && node.children.length > 0) {
						this.pages.push(node);
						this._traverse(node.children);
					} else {
						this.pages.push(node);
					}
				}
			}
		});
	</script>
</polymer-element>
