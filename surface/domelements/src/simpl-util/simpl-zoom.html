<!--
/**
 * This file is part of SIMPL4(http://simpl4.org).
 *
 * 	Copyright [2014] [Manfred Sattler] <manfred@ms123.org>
 *
 * SIMPL4 is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * SIMPL4 is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with SIMPL4.  If not, see <http://www.gnu.org/licenses/>.
 */
-->
<dom-module id="simpl-zoom">
	<style>
		img {
			width: 100%;
		}
		:host /deep/ #imageDialog {
			position: fixed;
			top: 0;
		}
		:host /deep/ #imageDialog /deep/ #scroller {
			max-height: 100%;
			min-height: 100%;
			height: 100%;
		}
		@media screen and (max-width: 767px) {
			:host /deep/ #imageDialog {
				left: 0px;
			}
		}

	</style>

	<template>

		<div id="imageSmall">
			<img src="[[image]]" width="400" style$="[[styleSmall]]">
		</div>

		<paper-fullscreen-dialog class="flex grid row column" no-cancel-on-outside-click xith-backdrop on-iron-overlay-opened="dialogOpened" id="imageDialog">
			<img class="flex grid row" id="bigImage" src="[[image]]" xtyle$="[[styleSmall]]">
		</paper-fullscreen-dialog>

	</template>

	<script>
		Polymer( {
			is: "simpl-zoom",
			properties: {
				styleSmall: {
					computed: "computeStyleSmall(maxWidthSmall)"
				},
				maxWidthSmall: {
					value: "400px",
					type: String
				},
				image: {
					value: "bigpicture.svg",
					type: String
				}
			},
			computeStyleSmall: function() {
				var ret = "width:" + this.maxWidthSmall;
				console.log( "computeStyleSmall:", ret );
				return ret;
			},
			dialogOpened: function() {
				var dh = $( this.$.imageDialog ).height();
				var ih = $( "#bigImage" ).height();
				$( "#bigImage" ).panzoom();
				$( "#bigImage" ).panzoom( "zoom", ( dh / ih ) * 0.9 );
				$( "#imageDialog" ).offset( {
					top: 0,
					left: this.isDrawerOpen() ? 200 : 0
				} )
				$( "#scroller" ).height( dh );
				$( "#bigImage" ).offset( {
					top: 56,
					left: this.isDrawerOpen() ? 200 : 0
				} )
				var self = this;
				$( "#bigImage" ).swipe( {
					tap: function( event, target ) {
						return false;
					},
					doubleTap: function( event, target ) {
						console.log( "You tapped " + target );
						self.async( function() {
							self.$.imageDialog.close();
						}, 50 );
					},
					doubleTapThreshold: 200
				} );
			},
			attached: function() {
				var self = this;
				$( "#imageSmall" ).swipe( {
					tap: function( event, target ) {
						return false;
					},
					doubleTap: function( event, target ) {
						console.log( "You tapped " + target );
						self.async( function() {
							self.$.imageDialog.open();
						}, 50 );
					},
					xwipe: function( event, direction, distance, duration, fingerCount, fingerData ) {
						console.log( "You swiped " + direction );
					}
				} );
			},
			isDrawerOpen: function() {
				return !document.querySelector( "#drawerPanel" ).narrow;
			},
			detached: function() {}
		} );

	</script>
</dom-module>
