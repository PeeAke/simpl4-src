<!--
/**
 * This file is part of SIMPL4(http://simpl4.org).
 *
 * 	Copyright [2014] [Manfred Sattler] <manfred@ms123.org>
 *
 * SIMPL4 is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * SIMPL4 is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with SIMPL4.  If not, see <http://www.gnu.org/licenses/>.
 */
-->

<polymer-element name="simpl4-form" attributes="namespace name">

	<template>
		<style>
			:host {
				display: block;
				background: #eeeeee;
				padding:10px;
			}
			.input {
				width: 250px;
			}
		</style>
		<div vertical layout>
			<template repeat="{{shapes}}" id="t">
				<template if="{{ stencil.id=='Input' }}">
					<simpl4-input class="input" label="{{properties.label}}" autoValidate required floatinglabel></simpl4-input>
				</template>
				<template ref="t" repeat="{{childShapes}}"></template>
			</template>
		</div>
	</template>

	<script>
		Polymer({
			namespace: null,
			name: null,
			domReady: function() {
				console.debug("Form.Ready:" + tr('data.customer.cid'));
				var form = simpl4FormManager.getForm(this.name);
				this.shapes = this.sort(form).childShapes;
			},
			sort: function(shape) {
				if (shape.stencil.id.toLowerCase() == "input" || shape.stencil.id.toLowerCase() == 'textarea') {
					shape.properties.label = shape.childShapes[0].properties.xf_text;
					shape.childShapes = [];
				} else {
					shape.properties.label = "";
				}
				shape.childShapes = _.sortBy(shape.childShapes, function(element) {
					return element.bounds.upperLeft.y * 10000 + element.bounds.upperLeft.x;
				});
				var childs = shape.childShapes;
				for (var i = 0; i < childs.length; i++) {
					this.sort(childs[i]);
				}
				return shape;
			}
		});
	</script>

</polymer-element>
